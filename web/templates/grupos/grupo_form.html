{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">{% if object %}Editar Grupo{% else %}Crear Grupo{% endif %}</h3>
      <p class="text-muted mb-0">
        Define el nombre del grupo y asigna los funcionarios que pertenecerán a este grupo.
      </p>
    </div>
  </div>

  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      <strong>Revisa esto:</strong>
      <div>{{ form.non_field_errors }}</div>
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}
    {{ form.media }}

    <style>
      /* ✅ Select2: ancho full + estilos consistentes (igual a menú) */
      .select2-container { width: 100% !important; }
      .select2-container--open { z-index: 99999 !important; }

      .select2-container--default .select2-selection--single,
      .select2-container--default .select2-selection--multiple {
        min-height: calc(1.5em + .75rem + 2px);
        border: 1px solid #ced4da;
        border-radius: .375rem;
        display: flex;
        align-items: center;
        padding-left: .25rem;
      }

      .select2-container--default .select2-selection--multiple {
        padding: .25rem .5rem;
      }

      /* ✅ Evita que dropdown se corte */
      .card, .card-body { overflow: visible !important; }
    </style>

    <div class="card">
      <div class="card-body">
        <h5 class="mb-3">Datos del grupo</h5>

        <div class="row g-3">
          <div class="col-12 col-md-6">
            {{ form.name|as_crispy_field }}
            <small class="text-muted">Asigna un nombre descriptivo para este grupo de usuarios.</small>
          </div>

          <div class="col-12">
            {{ form.funcionarios|as_crispy_field }}

            {% if object %}
              <small class="text-muted">
                En edición puedes mover funcionarios desde otros grupos (quedarán solo en este).
              </small>
            {% else %}
              <small class="text-muted">
                Solo aparecen funcionarios que aún no pertenecen a ningún grupo.
              </small>
            {% endif %}
          </div>
        </div>

        <div class="d-flex flex-wrap gap-2 mt-4">
          <button type="submit" class="btn btn-info text-white">
            <i class="ti-save"></i> Guardar
          </button>
          <a href="{% url 'web:grupo_list' %}" class="btn btn-light">
            Cancelar
          </a>
        </div>

      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Select2 para funcionarios (multiple)
  $(function(){
    const $sel = $("#id_funcionarios");
    if ($sel.length){
      $sel.select2({
        width: "100%",
        placeholder: "Selecciona funcionarios",
        closeOnSelect: false
      });
    }
  });
</script>
{% endblock %}
