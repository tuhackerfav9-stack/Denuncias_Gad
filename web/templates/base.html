{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>{% block title %}GAD Municipal de Salcedo{% endblock %}</title>

  <!-- Skydash CSS -->
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/feather/feather.css' %}">
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/ti-icons/css/themify-icons.css' %}">
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/css/vendor.bundle.base.css' %}">
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/font-awesome/css/font-awesome.min.css' %}">
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/mdi/css/materialdesignicons.min.css' %}">

  <!-- DataTables (tu versión actual) -->
  <link rel="stylesheet" href="{% static 'skydash/assets/vendors/datatables.net-bs4/dataTables.bootstrap4.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'skydash/assets/js/select.dataTables.min.css' %}">

  <!-- Skydash main css -->
  <link rel="stylesheet" href="{% static 'skydash/assets/css/style.css' %}">

  <!-- FavIcon -->
  <link rel="shortcut icon" href="{% static 'assets/img/logo_gad_municipal_claro.png' %}" />

  <!-- jQuery + Chartkick -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="{% static 'chartkick/Chart.bundle.js' %}"></script>
  <script src="{% static 'chartkick/chartkick.js' %}"></script>

  <!-- iziToast -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Estilo Toastify-like (global) -->
  <style>
    /* Toastify-like */
    .iziToast {
      border-radius: 12px !important;
      box-shadow: 0 14px 30px rgba(0,0,0,.16) !important;
      padding: 14px 16px !important;
      overflow: hidden !important;
    }
    .iziToast:after { box-shadow: none !important; }
    .iziToast > .iziToast-body { min-height: 36px !important; }
    .iziToast > .iziToast-body .iziToast-texts { margin-left: 44px !important; }
    .iziToast > .iziToast-body .iziToast-title {
      font-weight: 700 !important;
      font-size: 14px !important;
      line-height: 1.2 !important;
    }
    .iziToast > .iziToast-body .iziToast-message {
      font-size: 14px !important;
      line-height: 1.35 !important;
      opacity: .95 !important;
    }
    .iziToast > .iziToast-progressbar {
      height: 3px !important;
    }

    /* Que no se corte en cards / dropdowns */
    .card, .card-body { overflow: visible !important; }

    /* helper: evita layout raro en topRight */
    .iziToast-wrapper { z-index: 999999 !important; }



   /*   Fix: perfil en una sola línea (PC) */
.nav-profile-link{
  display: flex !important;
  align-items: center !important;
  gap: .5rem;
  white-space: nowrap;
}

/*   El nombre NO debe empujar el círculo: se corta con ... */
.profile-name{
  max-width: 200px;          /* ajusta si quieres más/menos */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/*   Avatar fijo, no se estira ni baja */
.profile-avatar-circle{
  width: 36px;
  height: 36px;
  flex: 0 0 36px;
  border-radius: 50%;
  background-color: var(--bs-info, #41545a); /* azul info */
  color: #fff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: .5px;
}


  </style>

  {% block extra_css %}{% endblock %}
</head>

<body>
  <div class="container-scroller">

    <!-- NAVBAR -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
        <a class="navbar-brand brand-logo me-5" href="{% url 'web:dashboard' %}">
          <img src="{% static 'assets/img/logo_gad_municipal_claro.png' %}" class="me-2" alt="logo" />
        </a>
        <a class="navbar-brand brand-logo-mini" href="{% url 'web:dashboard' %}">
          <img src="{% static 'assets/img/logo_gad_municipal_claro.png' %}" alt="logo" />
        </a>
      </div>

      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="icon-menu"></span>
        </button>

        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item nav-profile dropdown">

            <a class="nav-link dropdown-toggle nav-profile-link" href="#" data-bs-toggle="dropdown" id="profileDropdown">
            <span class="me-2 d-none d-lg-inline text-dark profile-name">
              {{ user.get_full_name|default:user.username }}
            </span>

            <div class="profile-avatar-circle">
              {{ user.first_name|default:user.username|slice:":1"|upper }}
              {% if user.last_name %}
                {{ user.last_name|slice:":1"|upper }}
              {% endif %}
            </div>
          </a>


            <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
              <div class="dropdown-item text-muted small">{{ user.email }}</div>
              <div class="dropdown-divider"></div>

              <form method="post" action="{% url 'web:logout' %}">
                {% csrf_token %}
                <button type="submit" class="dropdown-item">
                  <i class="ti-power-off text-info"></i> Cerrar sesión
                </button>
              </form>
            </div>
          </li>
        </ul>

        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="icon-menu"></span>
        </button>
      </div>
    </nav>

    <div class="container-fluid page-body-wrapper">

      <!-- SIDEBAR -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">

          <!-- Dashboard fijo -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'web:dashboard' %}">
              <i class="icon-grid menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>

          <!-- Menús dinámicos -->
          {% for menu in menus_principales %}
            {% with children=menu.children %}
              {% if children %}
                <li class="nav-item">
                  <a class="nav-link"
                     data-bs-toggle="collapse"
                     href="#menu-{{ menu.id }}"
                     aria-expanded="false"
                     aria-controls="menu-{{ menu.id }}">
                    <i class="{% if menu.icono %}{{ menu.icono }}{% else %}icon-layout{% endif %} menu-icon"></i>
                    <span class="menu-title">{{ menu.nombre }}</span>
                    <i class="menu-arrow"></i>
                  </a>

                  <div class="collapse" id="menu-{{ menu.id }}">
                    <ul class="nav flex-column sub-menu">
                      {% for submenu in children %}
                        <li class="nav-item">
                          {% if submenu.url %}
                            <a class="nav-link"
                               href="{% if ':' in submenu.url %}{% url submenu.url %}{% else %}{{ submenu.url }}{% endif %}">
                              {{ submenu.nombre }}
                            </a>
                          {% else %}
                            <span class="nav-link text-muted">{{ submenu.nombre }}</span>
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                </li>
              {% else %}
                <li class="nav-item">
                  {% if menu.url %}
                    <a class="nav-link"
                       href="{% if ':' in menu.url %}{% url menu.url %}{% else %}{{ menu.url }}{% endif %}">
                      <i class="{% if menu.icono %}{{ menu.icono }}{% else %}icon-grid-2{% endif %} menu-icon"></i>
                      <span class="menu-title">{{ menu.nombre }}</span>
                    </a>
                  {% else %}
                    <a class="nav-link" href="javascript:void(0)">
                      <i class="{% if menu.icono %}{{ menu.icono }}{% else %}icon-grid-2{% endif %} menu-icon"></i>
                      <span class="menu-title">{{ menu.nombre }}</span>
                    </a>
                  {% endif %}
                </li>
              {% endif %}
            {% endwith %}
          {% endfor %}

          {% if user.is_superuser %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'web:menu_list' %}">
                <i class="icon-paper menu-icon"></i>
                <span class="menu-title">Menús (Admin)</span>
              </a>
            </li>
          {% endif %}

        </ul>
      </nav>

      <!-- MAIN PANEL -->
      <div class="main-panel">
        <div class="content-wrapper">
          {% block content %}{% endblock %}
        </div>

        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">
              Desarrollado: Cristian Aguila - Alejandra Erreyes / GAD Municipal de Salcedo © {% now "Y" %} / V1.0
            </span>
          </div>
        </footer>
      </div>

    </div>
  </div>

  <!-- Skydash JS -->
  <script src="{% static 'skydash/assets/vendors/js/vendor.bundle.base.js' %}"></script>
  <script src="{% static 'skydash/assets/js/off-canvas.js' %}"></script>
  <script src="{% static 'skydash/assets/js/template.js' %}"></script>
  <script src="{% static 'skydash/assets/js/settings.js' %}"></script>
  <script src="{% static 'skydash/assets/js/todolist.js' %}"></script>

  <!-- iziToast JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Django messages -> Toast global -->
  {% include "partials/alerts.html" %}

  {% block extra_js %}{% endblock %}
</body>
</html>

