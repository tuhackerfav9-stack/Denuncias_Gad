{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <style>
    @page {
      size: A4;
      margin: 1.4cm;
    }

    body{
      font-family: Arial, sans-serif;
      font-size: 11px;
      color:#1f2937;
    }

    .header{
      width:100%;
      border-bottom: 2px solid #0dcaf0;
      padding-bottom: 6px;
      margin-bottom: 10px;
    }
    .logo{
      width: 120px;
    }
    .title{
      font-size: 16px;
      font-weight: 700;
      margin: 0;
      padding: 0;
    }
    .subtitle{
      margin: 2px 0 0 0;
      color:#6b7280;
      font-size: 11px;
    }

    .badge{
      display:inline-block;
      padding: 4px 8px;
      border-radius: 10px;
      background:#0dcaf0;
      color:white;
      font-weight:700;
      font-size:10px;
    }

    .section{
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
    }

    .section h2{
      font-size: 12px;
      margin: 0 0 8px 0;
      color:#111827;
    }

    table{
      width:100%;
      border-collapse: collapse;
    }
    td{
      padding: 6px 8px;
      vertical-align: top;
    }
    .label{
      width: 30%;
      color:#6b7280;
      font-weight:700;
    }
    .value{
      width: 70%;
    }

    .hr{
      border-top: 1px solid #e5e7eb;
      margin: 10px 0;
    }

    .bigbox{
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 10px;
      background:#f9fafb;
      white-space: pre-wrap;
    }

    .signature-wrap{
      margin-top: 18px;
    }
    .sign{
      width: 48%;
      display:inline-block;
      vertical-align: top;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 10px;
      height: 90px;
    }
    .sign-title{
      color:#6b7280;
      font-size: 10px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .page-break{
      page-break-after: always;
    }

    .footer-note{
      margin-top: 10px;
      color:#6b7280;
      font-size: 10px;
    }
  </style>
</head>

<body>

  <!-- =========================
       HOJA 1: DATOS DE DENUNCIA + ASIGNACIÓN
  ========================== -->
  <div class="header">
    <table>
      <tr>
        <td style="width:140px;">
          <img class="logo" src="{% static 'assets/img/logo_gad_municipal_claro.png' %}" alt="GAD Salcedo">
        </td>
        <td>
          <p class="title">Reporte Oficial de Denuncia</p>
          <p class="subtitle">GAD Municipal de Salcedo - Sistema de Denuncias</p>
          <span class="badge">DENUNCIA #{{ denuncia.id }}</span>
        </td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>1. Información general de la denuncia</h2>
    <table>
      <tr>
        <td class="label">Tipo de denuncia</td>
        <td class="value">{{ denuncia.tipo_denuncia.nombre }}</td>
      </tr>
      <tr>
        <td class="label">Estado</td>
        <td class="value">{{ denuncia.estado|upper }}</td>
      </tr>
      <tr>
        <td class="label">Fecha de creación</td>
        <td class="value">{{ denuncia.created_at|date:"d/m/Y H:i" }}</td>
      </tr>
      <tr>
        <td class="label">Origen</td>
        <td class="value">{{ denuncia.origen }}</td>
      </tr>
      <tr>
        <td class="label">Departamento asignado</td>
        <td class="value">
          {% if denuncia.asignado_departamento %}
            {{ denuncia.asignado_departamento.nombre }}
          {% else %}
            No asignado
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Funcionario asignado</td>
        <td class="value">
          {% if denuncia.asignado_funcionario %}
            {{ denuncia.asignado_funcionario.nombres }} {{ denuncia.asignado_funcionario.apellidos }}
            {% if denuncia.asignado_funcionario.cargo %} - {{ denuncia.asignado_funcionario.cargo }}{% endif %}
          {% else %}
            No asignado
          {% endif %}
        </td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>2. Ubicación y referencia</h2>
    <table>
      <tr>
        <td class="label">Referencia</td>
        <td class="value">{{ denuncia.referencia|default:"(Sin referencia)" }}</td>
      </tr>
      <tr>
        <td class="label">Dirección (texto)</td>
        <td class="value">{{ denuncia.direccion_texto|default:"(No registrada)" }}</td>
      </tr>
      <tr>
        <td class="label">Coordenadas</td>
        <td class="value">Lat: {{ denuncia.latitud }} | Lng: {{ denuncia.longitud }}</td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>3. Descripción</h2>
    <div class="bigbox">{{ denuncia.descripcion }}</div>
  </div>

  <div class="footer-note">
    Documento generado automáticamente. Verifique la información antes de archivar.
  </div>

  <div class="page-break"></div>


  <!-- =========================
       HOJA 2: DATOS DEL CIUDADANO (incluye cédula)
  ========================== -->
  <div class="header">
    <table>
      <tr>
        <td style="width:140px;">
          <img class="logo" src="{% static 'assets/img/logo_gad_municipal_claro.png' %}" alt="GAD Salcedo">
        </td>
        <td>
          <p class="title">Identificación del Ciudadano</p>
          <p class="subtitle">Denuncia #{{ denuncia.id }}</p>
          <span class="badge">CIUDADANO</span>
        </td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>4. Datos del ciudadano</h2>
    <table>
      <tr>
        <td class="label">Nombres</td>
        <td class="value">{{ denuncia.ciudadano.nombres }}</td>
      </tr>
      <tr>
        <td class="label">Apellidos</td>
        <td class="value">{{ denuncia.ciudadano.apellidos }}</td>
      </tr>
      <tr>
        <td class="label">Cédula</td>
        <td class="value"><strong>{{ denuncia.ciudadano.cedula }}</strong></td>
      </tr>
      <tr>
        <td class="label">Teléfono</td>
        <td class="value">{{ denuncia.ciudadano.telefono|default:"(No registrado)" }}</td>
      </tr>
    </table>
  </div>

  <div class="signature-wrap">
    <div class="sign">
      <div class="sign-title">Firma del ciudadano</div>
      <div style="color:#9ca3af;">(Espacio para firma manuscrita)</div>
    </div>
    <div class="sign" style="margin-left:4%;">
      <div class="sign-title">Huella / Verificación</div>
      <div style="color:#9ca3af;">(Espacio para verificación física)</div>
    </div>
  </div>

  <div class="footer-note">
    Esta hoja se archiva como respaldo de identificación.
  </div>

  <div class="page-break"></div>


  <!-- =========================
       HOJA 3: RESPUESTA FINAL + FUNCIONARIO QUE RESPONDIÓ
  ========================== -->
  <div class="header">
    <table>
      <tr>
        <td style="width:140px;">
          <img class="logo" src="{% static 'assets/img/logo_gad_municipal_claro.png' %}" alt="GAD Salcedo">
        </td>
        <td>
          <p class="title">Resolución / Respuesta Final</p>
          <p class="subtitle">Denuncia #{{ denuncia.id }}</p>
          <span class="badge">FINAL</span>
        </td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>5. Resultado</h2>
    <table>
      <tr>
        <td class="label">Estado final</td>
        <td class="value"><strong>{{ denuncia.estado|upper }}</strong></td>
      </tr>
      <tr>
        <td class="label">Fecha de emisión</td>
        <td class="value">
          {% if respuesta %}
            {{ respuesta.created_at|date:"d/m/Y H:i" }}
          {% else %}
            (Sin respuesta registrada)
          {% endif %}
        </td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>6. Mensaje / Informe del funcionario</h2>
    <div class="bigbox">
      {% if respuesta %}
        {{ respuesta.mensaje }}
      {% else %}
        No existe una respuesta registrada en el sistema para esta denuncia.
      {% endif %}
    </div>
  </div>

  <div class="section">
    <h2>7. Funcionario que respondió</h2>
    <table>
      <tr>
        <td class="label">Funcionario</td>
        <td class="value">
          {% if respuesta and respuesta.funcionario %}
            {{ respuesta.funcionario.nombres }} {{ respuesta.funcionario.apellidos }}
          {% else %}
            (No identificado)
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Cédula</td>
        <td class="value">
          {% if respuesta and respuesta.funcionario %}
            {{ respuesta.funcionario.cedula }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Cargo</td>
        <td class="value">
          {% if respuesta and respuesta.funcionario %}
            {{ respuesta.funcionario.cargo|default:"(Sin cargo)" }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Departamento</td>
        <td class="value">
          {% if respuesta and respuesta.funcionario and respuesta.funcionario.departamento %}
            {{ respuesta.funcionario.departamento.nombre }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="label">Teléfono</td>
        <td class="value">
          {% if respuesta and respuesta.funcionario %}
            {{ respuesta.funcionario.telefono|default:"(No registrado)" }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
    </table>
  </div>

  <div class="signature-wrap">
    <div class="sign">
      <div class="sign-title">Firma del funcionario responsable</div>
      <div style="color:#9ca3af;">(Espacio para firma)</div>
    </div>
    <div class="sign" style="margin-left:4%;">
      <div class="sign-title">Sello institucional</div>
      <div style="color:#9ca3af;">(Espacio para sello)</div>
    </div>
  </div>

  <div class="footer-note">
    Esta hoja certifica la atención final (resuelta/rechazada) para archivo físico.
  </div>

</body>
</html>
