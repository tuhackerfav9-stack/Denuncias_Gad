{% extends 'base.html' %}
{% block content %}
<div class="container-fluid mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="card shadow-sm">
        <div class="card-header bg-info">
          <h5 class="card-title mb-0 text-white">
            <i class="bi bi-person me-2"></i>Detalle Usuario Web (Maestro)
          </h5>
        </div>

        <div class="card-body">
          {% with u=link.web_user f=link.funcionario dom=link.funcionario.usuario dep=link.funcionario.departamento %}
          <div class="row g-4">

            <div class="col-lg-6">
              <h6 class="mb-3"><i class="bi bi-person-badge me-2"></i>auth_user (Web)</h6>
              <dl class="row">
                <dt class="col-sm-4">ID</dt><dd class="col-sm-8">{{ u.id }}</dd>
                <dt class="col-sm-4">Usuario</dt><dd class="col-sm-8">{{ u.username }}</dd>
                <dt class="col-sm-4">Correo</dt><dd class="col-sm-8">{{ u.email }}</dd>
                <dt class="col-sm-4">Nombres</dt><dd class="col-sm-8">{{ u.first_name }}</dd>
                <dt class="col-sm-4">Apellidos</dt><dd class="col-sm-8">{{ u.last_name }}</dd>
                <dt class="col-sm-4">Activo</dt>
                <dd class="col-sm-8">
                  {% if u.is_active %}<span class="badge bg-success">Activo</span>{% else %}<span class="badge bg-danger">Inactivo</span>{% endif %}
                </dd>
                <dt class="col-sm-4">Superadmin</dt>
                <dd class="col-sm-8">
                  {% if u.is_superuser %}<span class="badge bg-dark">Sí</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}
                </dd>
                <dt class="col-sm-4">Registrado</dt><dd class="col-sm-8"><small class="text-muted">{{ u.date_joined|date:"d/m/Y H:i" }}</small></dd>
                <dt class="col-sm-4">Último acceso</dt>
                <dd class="col-sm-8">
                  {% if u.last_login %}<small class="text-muted">{{ u.last_login|date:"d/m/Y H:i" }}</small>{% else %}<small class="text-muted">Nunca</small>{% endif %}
                </dd>
              </dl>

              <div class="mb-2">
                <label class="form-label"><i class="bi bi-people me-1"></i>Grupo</label>
                <div>
                  {% for g in u.groups.all %}
                    <span class="badge bg-info text-dark me-1">{{ g.name }}</span>
                  {% empty %}
                    <span class="text-muted fst-italic">Sin grupo</span>
                  {% endfor %}
                </div>
              </div>
            </div>

            <div class="col-lg-6">
              <h6 class="mb-3"><i class="bi bi-building me-2"></i>funcionarios (Operador)</h6>
              <dl class="row">
                <dt class="col-sm-4">Usuario UUID</dt><dd class="col-sm-8">{{ f.usuario_id }}</dd>
                <dt class="col-sm-4">Cédula</dt><dd class="col-sm-8">{{ f.cedula }}</dd>
                <dt class="col-sm-4">Nombres</dt><dd class="col-sm-8">{{ f.nombres }}</dd>
                <dt class="col-sm-4">Apellidos</dt><dd class="col-sm-8">{{ f.apellidos }}</dd>
                <dt class="col-sm-4">Teléfono</dt><dd class="col-sm-8">{{ f.telefono|default:"-" }}</dd>
                <dt class="col-sm-4">Cargo</dt><dd class="col-sm-8">{{ f.cargo|default:"-" }}</dd>
                <dt class="col-sm-4">Departamento</dt>
                <dd class="col-sm-8">
                  {% if dep %}<span class="badge bg-secondary">{{ dep.nombre }}</span>{% else %}<span class="text-muted fst-italic">No asignado</span>{% endif %}
                </dd>
                <dt class="col-sm-4">Activo</dt>
                <dd class="col-sm-8">
                  {% if f.activo %}<span class="badge bg-success">Activo</span>{% else %}<span class="badge bg-danger">Inactivo</span>{% endif %}
                </dd>
              </dl>

              <hr class="my-3">

              <h6 class="mb-3"><i class="bi bi-diagram-3 me-2"></i>usuarios (Dominio UUID)</h6>
              <dl class="row">
                <dt class="col-sm-4">UUID</dt><dd class="col-sm-8">{{ dom.id }}</dd>
                <dt class="col-sm-4">Tipo</dt><dd class="col-sm-8">{{ dom.tipo }}</dd>
                <dt class="col-sm-4">Correo</dt><dd class="col-sm-8">{{ dom.correo }}</dd>
                <dt class="col-sm-4">Activo</dt>
                <dd class="col-sm-8">
                  {% if dom.activo %}<span class="badge bg-success">Activo</span>{% else %}<span class="badge bg-danger">Inactivo</span>{% endif %}
                </dd>
              </dl>

              <div class="alert alert-light border small mb-0">
                <i class="bi bi-link-45deg me-1"></i>
                <b>Enlace (puente):</b> funcionario_web_user → web_user_id={{ link.web_user_id }} / funcionario_id={{ link.funcionario_id }}
              </div>
            </div>

          </div>

          <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'web:unified_user_list' %}" class="btn btn-secondary">
              <i class="bi bi-arrow-left me-2"></i>Volver
            </a>
            <div class="d-flex gap-2">
              <a href="{% url 'web:unified_user_update' u.pk %}" class="btn btn-warning">
                <i class="bi bi-pencil me-2"></i>Editar
              </a>

              {% if can_hard_delete %}
                <a href="{% url 'web:unified_user_delete' u.pk %}" class="btn btn-danger">
                  <i class="bi bi-trash me-2"></i>Eliminar
                </a>
              {% else %}
                <a href="{% url 'web:unified_user_delete' u.pk %}" class="btn btn-outline-secondary">
                  <i class="bi bi-person-x me-2"></i>Desactivar
                </a>
              {% endif %}
            </div>
          </div>

          {% endwith %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
